(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{189:function(s,t,a){"use strict";a.r(t);var n=a(0),e=Object(n.a)({},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"content"},[s._m(0),s._v(" "),s._m(1),s._v(" "),s._m(2),s._v(" "),s._m(3),s._v(" "),a("p",[s._v("数据更新时，渲染得到新的 Virtual DOM，与上一次得到的 Virtual DOM 进行 diff，记录下所有需要在 DOM 上进行的变更，然后在 patch 过程中应用到 DOM 上，实现 UI 的同步更新。")]),s._v(" "),s._m(4),s._v(" "),s._m(5),s._v(" "),a("p",[s._v("比如 dom 是这样的：")]),s._v(" "),s._m(6),a("p",[s._v("对应的 virtual DOM（伪代码,实际复杂很多）：")]),s._v(" "),s._m(7),s._m(8),s._v(" "),s._m(9),s._v(" "),s._m(10),s._m(11),s._m(12),s._v(" "),s._m(13),s._v(" "),a("ul",[a("li",[s._m(14),s._v(" "),a("p",[s._v("1、")]),s._v(" "),s._m(15),a("p",[s._v("2、")]),s._v(" "),s._m(16),a("p",[s._v("3、当 vnode 和 oldVnode 都存在时：")]),s._v(" "),a("ul",[a("li",[s._v("3.1 ("),a("em",[s._v("详见 patch 重点："),a("router-link",{attrs:{to:"/vue/patchVnode.html"}},[s._v("patchVnode")])],1),s._v(")")])]),s._v(" "),s._m(17),s._m(18),s._v(" "),s._m(19),a("p",[s._v("4、最后返回 vnode.elm")]),s._v(" "),s._m(20),a("br")])]),s._v(" "),a("div",{staticClass:"tip custom-block"},[a("p",{staticClass:"custom-block-title"},[s._v("注释")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/510team/vue-resource-analysis/blob/master/src/core/vdom/patch.js",target:"_blank",rel:"noopener noreferrer"}},[s._v("查看 vue 相关源码"),a("OutboundLink")],1)])])])},[function(){var s=this.$createElement,t=this._self._c||s;return t("h1",{attrs:{id:"diff-算法-与-patch-（第一部分）"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#diff-算法-与-patch-（第一部分）","aria-hidden":"true"}},[this._v("#")]),this._v(" diff 算法 与 patch （第一部分）")])},function(){var s=this.$createElement,t=this._self._c||s;return t("h2",{attrs:{id:"what"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#what","aria-hidden":"true"}},[this._v("#")]),this._v(" What")])},function(){var s=this.$createElement,t=this._self._c||s;return t("ul",[t("li",[this._v("diff 算法：一种对比新、旧虚拟节点的算法")]),this._v(" "),t("li",[this._v("patch：打补丁，把新旧节点的差异，应该到 DOM 上")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("h2",{attrs:{id:"why"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#why","aria-hidden":"true"}},[this._v("#")]),this._v(" Why")])},function(){var s=this.$createElement,t=this._self._c||s;return t("h2",{attrs:{id:"foreword"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#foreword","aria-hidden":"true"}},[this._v("#")]),this._v(" Foreword")])},function(){var s=this.$createElement,t=this._self._c||s;return t("h4",{attrs:{id:"_1、virtual-dom-可以看做一棵模拟了-dom-树的-javascript-树，用-js-对象表示-dom-结构，可以根据虚拟-dom-树构建出真实的-dom-树"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、virtual-dom-可以看做一棵模拟了-dom-树的-javascript-树，用-js-对象表示-dom-结构，可以根据虚拟-dom-树构建出真实的-dom-树","aria-hidden":"true"}},[this._v("#")]),this._v(" 1、Virtual DOM 可以看做一棵模拟了 DOM 树的 JavaScript 树，用 JS 对象表示 DOM 结构，可以根据虚拟 DOM 树构建出真实的 DOM 树")])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token operator"}},[s._v("<")]),s._v("div"),a("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v("\n        "),a("span",{attrs:{class:"token operator"}},[s._v("<")]),s._v("p"),a("span",{attrs:{class:"token operator"}},[s._v(">")]),a("span",{attrs:{class:"token number"}},[s._v("123")]),a("span",{attrs:{class:"token operator"}},[s._v("<")]),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("p"),a("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{attrs:{class:"token operator"}},[s._v("<")]),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("div"),a("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[s._v("var")]),s._v(" Vnode "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    tag"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v('"div"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    children"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" tag"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v('"p"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" text"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v('"123"')]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("h4",{attrs:{id:"_2、vue-的-diff-算法是基于-snabbdom-改造过来的，复杂度为-o-n"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、vue-的-diff-算法是基于-snabbdom-改造过来的，复杂度为-o-n","aria-hidden":"true"}},[this._v("#")]),this._v(" 2、Vue 的 diff 算法是基于 snabbdom 改造过来的，复杂度为 O(n)")])},function(){var s=this.$createElement,t=this._self._c||s;return t("div",{staticClass:"tip custom-block"},[t("p",{staticClass:"custom-block-title"},[this._v("比较只会在同层级进行, 不会跨层级比较。")]),this._v(" "),t("p",[this._v("递归地进行同级 vnode 的 diff，最终实现整个 DOM 树的更新")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token operator"}},[s._v("<")]),a("span",{attrs:{class:"token operator"}},[s._v("!")]),a("span",{attrs:{class:"token operator"}},[s._v("--")]),s._v(" 之前 "),a("span",{attrs:{class:"token operator"}},[s._v("--")]),a("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{attrs:{class:"token operator"}},[s._v("<")]),s._v("div"),a("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),a("span",{attrs:{class:"token operator"}},[s._v("<")]),a("span",{attrs:{class:"token operator"}},[s._v("!")]),a("span",{attrs:{class:"token operator"}},[s._v("--")]),s._v(" 层级"),a("span",{attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("--")]),a("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  "),a("span",{attrs:{class:"token operator"}},[s._v("<")]),s._v("p"),a("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v("            "),a("span",{attrs:{class:"token operator"}},[s._v("<")]),a("span",{attrs:{class:"token operator"}},[s._v("!")]),a("span",{attrs:{class:"token operator"}},[s._v("--")]),s._v(" 层级"),a("span",{attrs:{class:"token number"}},[s._v("2")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("--")]),a("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v("\n    "),a("span",{attrs:{class:"token operator"}},[s._v("<")]),s._v("b"),a("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v(" aoy "),a("span",{attrs:{class:"token operator"}},[s._v("<")]),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("b"),a("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v("   "),a("span",{attrs:{class:"token operator"}},[s._v("<")]),a("span",{attrs:{class:"token operator"}},[s._v("!")]),a("span",{attrs:{class:"token operator"}},[s._v("--")]),s._v(" 层级"),a("span",{attrs:{class:"token number"}},[s._v("3")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("--")]),a("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v("\n    "),a("span",{attrs:{class:"token operator"}},[s._v("<")]),s._v("span"),a("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v("diff"),a("span",{attrs:{class:"token operator"}},[s._v("<")]),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("Span"),a("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  "),a("span",{attrs:{class:"token operator"}},[s._v("<")]),a("span",{attrs:{class:"token operator"}},[s._v("/")]),a("span",{attrs:{class:"token constant"}},[s._v("P")]),a("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{attrs:{class:"token operator"}},[s._v("<")]),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("div"),a("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token operator"}},[s._v("<")]),a("span",{attrs:{class:"token operator"}},[s._v("!")]),a("span",{attrs:{class:"token operator"}},[s._v("--")]),s._v(" 之后 "),a("span",{attrs:{class:"token operator"}},[s._v("--")]),a("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{attrs:{class:"token operator"}},[s._v("<")]),s._v("div"),a("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v("            "),a("span",{attrs:{class:"token operator"}},[s._v("<")]),a("span",{attrs:{class:"token operator"}},[s._v("!")]),a("span",{attrs:{class:"token operator"}},[s._v("--")]),s._v(" 层级"),a("span",{attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("--")]),a("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  "),a("span",{attrs:{class:"token operator"}},[s._v("<")]),s._v("p"),a("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v("             "),a("span",{attrs:{class:"token operator"}},[s._v("<")]),a("span",{attrs:{class:"token operator"}},[s._v("!")]),a("span",{attrs:{class:"token operator"}},[s._v("--")]),s._v(" 层级"),a("span",{attrs:{class:"token number"}},[s._v("2")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("--")]),a("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v("\n      "),a("span",{attrs:{class:"token operator"}},[s._v("<")]),s._v("b"),a("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v(" aoy "),a("span",{attrs:{class:"token operator"}},[s._v("<")]),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("b"),a("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),a("span",{attrs:{class:"token operator"}},[s._v("<")]),a("span",{attrs:{class:"token operator"}},[s._v("!")]),a("span",{attrs:{class:"token operator"}},[s._v("--")]),s._v(" 层级"),a("span",{attrs:{class:"token number"}},[s._v("3")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("--")]),a("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  "),a("span",{attrs:{class:"token operator"}},[s._v("<")]),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("p"),a("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  "),a("span",{attrs:{class:"token operator"}},[s._v("<")]),s._v("span"),a("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v("diff"),a("span",{attrs:{class:"token operator"}},[s._v("<")]),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("Span"),a("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v("     "),a("span",{attrs:{class:"token operator"}},[s._v("<")]),a("span",{attrs:{class:"token operator"}},[s._v("!")]),a("span",{attrs:{class:"token operator"}},[s._v("--")]),s._v(" 层级"),a("span",{attrs:{class:"token number"}},[s._v("2")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("--")]),a("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{attrs:{class:"token operator"}},[s._v("<")]),a("span",{attrs:{class:"token operator"}},[s._v("/")]),s._v("div"),a("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("p",[s._v("我们可能期望将"),a("code",[s._v("<span>")]),s._v("直接移动到"),a("code",[s._v("<p>")]),s._v("的后边，这是最优的操作。但是实际的 diff 操作是移除"),a("code",[s._v("<p>")]),s._v("里的"),a("code",[s._v("<span>")]),s._v("，再创建一个新的"),a("code",[s._v("<span>")]),s._v("插到"),a("code",[s._v("<p>")]),s._v("的后边。因为新加的"),a("code",[s._v("<span>")]),s._v("在层级 2，旧的在层级 3，属于不同层级的比较。")])},function(){var s=this.$createElement,t=this._self._c||s;return t("h2",{attrs:{id:"how"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#how","aria-hidden":"true"}},[this._v("#")]),this._v(" How")])},function(){var s=this.$createElement,t=this._self._c||s;return t("h4",{attrs:{id:"diff-流程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#diff-流程","aria-hidden":"true"}},[this._v("#")]),this._v(" Diff 流程")])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token comment"}},[s._v("/**如果 vnode 不存在，但是 oldVnode 存在，说明是需要销毁旧节点\n **/")]),s._v("\n"),a("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token function"}},[s._v("isUndef")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("vnode"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token function"}},[s._v("isDef")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("oldVnode"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("invokeDestroyHook")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("oldVnode"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("return")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token comment"}},[s._v("/**如果 vnode 存在，但是 oldVnode 不存在，说明是需要创建新节点\n **/")]),s._v("\n"),a("span",{attrs:{class:"token function"}},[s._v("createElm")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("vnode"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" insertedVnodeQueue"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token comment"}},[s._v("/**当 oldVnode 不是真实节点，并且 vnode 和 oldVnode 值得比较时，则调用 patchVnode 进行 patch，即直接修改现有的节点\n **/")]),s._v("\n"),a("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token operator"}},[s._v("!")]),s._v("isRealElement "),a("span",{attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("sameVnode")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("oldVnode"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" vnode"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{attrs:{class:"token comment"}},[s._v("// patch existing root node")]),s._v("\n    "),a("span",{attrs:{class:"token function"}},[s._v("patchVnode")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("oldVnode"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" vnode"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" insertedVnodeQueue"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" removeOnly"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("ul",[t("li",[this._v("3.2 如果 oldVnode 是真实节点，或 vnode 和 oldVnode 不值得比较，则找到 oldVnode.elm 的父节点，根据 vnode 创建一个真实的 DOM 节点，并插入到该父节点中的 oldVnode.elm 位置。")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" oldElm "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" oldVnode"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("elm"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" parentElm "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" nodeOps"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("parentNode")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("oldElm"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{attrs:{class:"token comment"}},[s._v("// create new node")]),s._v("\n"),a("span",{attrs:{class:"token function"}},[s._v("createElm")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n    vnode"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    insertedVnodeQueue"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{attrs:{class:"token comment"}},[s._v("// extremely rare edge case: do not insert if old element is in a")]),s._v("\n    "),a("span",{attrs:{class:"token comment"}},[s._v("// leaving transition. Only happens when combining transition +")]),s._v("\n    "),a("span",{attrs:{class:"token comment"}},[s._v("// keep-alive + HOCs. (#4590)")]),s._v("\n    oldElm"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("_leaveCb "),a("span",{attrs:{class:"token operator"}},[s._v("?")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("null")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" parentElm"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    nodeOps"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("nextSibling")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("oldElm"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[s._v("return")]),s._v(" vnode"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("elm"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])}],!1,null,null,null);e.options.__file="patch.md";t.default=e.exports}}]);