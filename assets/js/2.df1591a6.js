(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{160:function(t,s,n){t.exports=n.p+"assets/img/vue-diff1.9cb434a5.png"},161:function(t,s,n){t.exports=n.p+"assets/img/vue-diff2.e246d1e4.png"},162:function(t,s,n){t.exports=n.p+"assets/img/vue-diff3.e820663b.png"},163:function(t,s,n){t.exports=n.p+"assets/img/vue-diff4.690001ad.png"},164:function(t,s,n){t.exports=n.p+"assets/img/vue-diff5.163c24bb.png"},165:function(t,s,n){t.exports=n.p+"assets/img/vue-diff6.89941e3e.png"},166:function(t,s,n){t.exports=n.p+"assets/img/vue-diff7.d06b12fe.png"},195:function(t,s,n){"use strict";n.r(s);var a=[function(){var t=this.$createElement,s=this._self._c||t;return s("h1",{attrs:{id:"diff-算法-与-patch-（第三部分）"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#diff-算法-与-patch-（第三部分）","aria-hidden":"true"}},[this._v("#")]),this._v(" diff 算法 与 patch （第三部分）")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"what"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#what","aria-hidden":"true"}},[this._v("#")]),this._v(" What")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"how"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#how","aria-hidden":"true"}},[this._v("#")]),this._v(" How")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token comment"}},[t._v("/**\n *  oldCh:oldVNode chirdren\n *  newCh:newVNode chirdren\n *  StartIdx   开头索引\n *  EndIdx     结束索引\n *  vnode中的key，可以作为节点的标识\n * **/")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("3、在比较的过程中，变量会往中间靠，一旦 StartIdx>EndIdx 表明 oldCh 和 newCh 至少有一个已经遍历完了，就会结束比较。\n"),s("br")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"具体流程，上代码："}},[s("a",{staticClass:"header-anchor",attrs:{href:"#具体流程，上代码：","aria-hidden":"true"}},[this._v("#")]),this._v(" 具体流程，上代码：")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[t._v("let")]),t._v(" oldStartIdx "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token number"}},[t._v("0")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{attrs:{class:"token keyword"}},[t._v("let")]),t._v(" newStartIdx "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token number"}},[t._v("0")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{attrs:{class:"token keyword"}},[t._v("let")]),t._v(" oldEndIdx "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" oldCh"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length "),n("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),n("span",{attrs:{class:"token number"}},[t._v("1")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{attrs:{class:"token keyword"}},[t._v("let")]),t._v(" oldStartVnode "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" oldCh"),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{attrs:{class:"token number"}},[t._v("0")]),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{attrs:{class:"token keyword"}},[t._v("let")]),t._v(" oldEndVnode "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" oldCh"),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("oldEndIdx"),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{attrs:{class:"token keyword"}},[t._v("let")]),t._v(" newEndIdx "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" newCh"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length "),n("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),n("span",{attrs:{class:"token number"}},[t._v("1")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{attrs:{class:"token keyword"}},[t._v("let")]),t._v(" newStartVnode "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" newCh"),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{attrs:{class:"token number"}},[t._v("0")]),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{attrs:{class:"token keyword"}},[t._v("let")]),t._v(" newEndVnode "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" newCh"),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("newEndIdx"),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{attrs:{class:"token keyword"}},[t._v("let")]),t._v(" oldKeyToIdx"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" idxInOld"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" vnodeToMove"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" refElm"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("1、"),s("code",[this._v("oldStartIdx <= oldEndIdx && newStartIdx <= newEndIdx")]),this._v("时遍历的过程：")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:n(160),alt:"diff1"}}),this._v(" "),s("br")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token comment"}},[t._v("//2种情况，只移动索引")]),t._v("\n"),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token function"}},[t._v("isUndef")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldStartVnode"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    oldStartVnode "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" oldCh"),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{attrs:{class:"token operator"}},[t._v("++")]),t._v("oldStartIdx"),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{attrs:{class:"token comment"}},[t._v("// Vnode has been moved left")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token function"}},[t._v("isUndef")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldEndVnode"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    oldEndVnode "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" oldCh"),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{attrs:{class:"token operator"}},[t._v("--")]),t._v("oldEndIdx"),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br")])])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("\n"),n("span",{attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token function"}},[t._v("sameVnode")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldStartVnode"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newStartVnode"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{attrs:{class:"token comment"}},[t._v("//不需要对dom进行移动")]),t._v("\n    "),n("span",{attrs:{class:"token function"}},[t._v("patchVnode")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldStartVnode"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newStartVnode"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" insertedVnodeQueue"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    oldStartVnode "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" oldCh"),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{attrs:{class:"token operator"}},[t._v("++")]),t._v("oldStartIdx"),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    newStartVnode "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" newCh"),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{attrs:{class:"token operator"}},[t._v("++")]),t._v("newStartIdx"),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token function"}},[t._v("sameVnode")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldEndVnode"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newEndVnode"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{attrs:{class:"token comment"}},[t._v("//不需要对dom进行移动")]),t._v("\n    "),n("span",{attrs:{class:"token function"}},[t._v("patchVnode")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldEndVnode"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newEndVnode"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" insertedVnodeQueue"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    oldEndVnode "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" oldCh"),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{attrs:{class:"token operator"}},[t._v("--")]),t._v("oldEndIdx"),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    newEndVnode "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" newCh"),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{attrs:{class:"token operator"}},[t._v("--")]),t._v("newEndIdx"),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br")])])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token function"}},[t._v("sameVnode")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldStartVnode"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newEndVnode"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{attrs:{class:"token comment"}},[t._v("/**当oldStartVnode，newEndVnode是相同节点，说明oldStartVnode.el跑到oldEndVnode.el的后边了。\n     **/")]),t._v("\n    "),n("span",{attrs:{class:"token function"}},[t._v("patchVnode")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldStartVnode"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newEndVnode"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" insertedVnodeQueue"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    canMove "),n("span",{attrs:{class:"token operator"}},[t._v("&&")]),t._v("\n        nodeOps"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("insertBefore")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n            parentElm"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            oldStartVnode"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("elm"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            nodeOps"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("nextSibling")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldEndVnode"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("elm"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    oldStartVnode "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" oldCh"),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{attrs:{class:"token operator"}},[t._v("++")]),t._v("oldStartIdx"),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    newEndVnode "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" newCh"),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{attrs:{class:"token operator"}},[t._v("--")]),t._v("newEndIdx"),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("如图：\n"),s("img",{attrs:{src:n(161),alt:"diff2"}}),this._v(" "),s("br")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token function"}},[t._v("sameVnode")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldEndVnode"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newStartVnode"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{attrs:{class:"token comment"}},[t._v("/** 当oldEndVnode，newStartVnode是相同节点，说明 oldEndVnode.el跑到了oldStartVnode.el的前边。\n     **/")]),t._v("\n    "),n("span",{attrs:{class:"token function"}},[t._v("patchVnode")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldEndVnode"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newStartVnode"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" insertedVnodeQueue"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    canMove "),n("span",{attrs:{class:"token operator"}},[t._v("&&")]),t._v("\n        nodeOps"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("insertBefore")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n            parentElm"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            oldEndVnode"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("elm"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            oldStartVnode"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("elm\n        "),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    oldEndVnode "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" oldCh"),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{attrs:{class:"token operator"}},[t._v("--")]),t._v("oldEndIdx"),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    newStartVnode "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" newCh"),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{attrs:{class:"token operator"}},[t._v("++")]),t._v("newStartIdx"),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("如图：\n"),s("img",{attrs:{src:n(162),alt:"diff3"}})])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token function"}},[t._v("isUndef")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldKeyToIdx"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{attrs:{class:"token comment"}},[t._v("/**\n     * createKeyToOldIdx生成一个key与oldVnode的索引对应的map,只有第一次进来undefined的时候会生成\n     **/")]),t._v("\n    oldKeyToIdx "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("createKeyToOldIdx")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldCh"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" oldStartIdx"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" oldEndIdx"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{attrs:{class:"token comment"}},[t._v("/**如果newStartVnode存在key, 返回这个key在oldVnode中的索引值（即第几个节点，下标），否则调用findIdxInOld方法\b查找key在oldVnode中的索引值\n **/")]),t._v("\nidxInOld "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("isDef")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("newStartVnode"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("key"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{attrs:{class:"token operator"}},[t._v("?")]),t._v(" oldKeyToIdx"),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("newStartVnode"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("key"),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("findIdxInOld")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("newStartVnode"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" oldCh"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" oldStartIdx"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" oldEndIdx"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token function"}},[t._v("isUndef")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("idxInOld"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{attrs:{class:"token comment"}},[t._v("//newStartVnode没有key或者是该key没有在老节点中找到，则创建一个新的节点")]),t._v("\n    "),n("span",{attrs:{class:"token function"}},[t._v("createElm")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        newStartVnode"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        insertedVnodeQueue"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        parentElm"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        oldStartVnode"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("elm"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),n("span",{attrs:{class:"token boolean"}},[t._v("false")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        newCh"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        newStartIdx\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{attrs:{class:"token comment"}},[t._v("/**获取相同key的老节点**/")]),t._v("\n    vnodeToMove "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" oldCh"),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("idxInOld"),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token function"}},[t._v("sameVnode")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vnodeToMove"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newStartVnode"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{attrs:{class:"token comment"}},[t._v("//相同key值的\bvnodeToMove 与 newStartVnode 是同一个节点，将vnodeToMove.elm 插入到oldStartVnode.elm前面")]),t._v("\n        "),n("span",{attrs:{class:"token function"}},[t._v("patchVnode")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vnodeToMove"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" newStartVnode"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" insertedVnodeQueue"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        oldCh"),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("idxInOld"),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" undefined"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        canMove "),n("span",{attrs:{class:"token operator"}},[t._v("&&")]),t._v("\n            nodeOps"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("insertBefore")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("parentElm"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" vnodeToMove"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("elm"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" oldStartVnode"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("elm"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{attrs:{class:"token comment"}},[t._v("// same key but different element. treat as new element")]),t._v("\n        "),n("span",{attrs:{class:"token function"}},[t._v("createElm")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n            newStartVnode"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            insertedVnodeQueue"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            parentElm"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            oldStartVnode"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("elm"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),n("span",{attrs:{class:"token boolean"}},[t._v("false")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            newCh"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            newStartIdx\n        "),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nnewStartVnode "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" newCh"),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{attrs:{class:"token operator"}},[t._v("++")]),t._v("newStartIdx"),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br"),n("span",{staticClass:"line-number"},[t._v("18")]),n("br"),n("span",{staticClass:"line-number"},[t._v("19")]),n("br"),n("span",{staticClass:"line-number"},[t._v("20")]),n("br"),n("span",{staticClass:"line-number"},[t._v("21")]),n("br"),n("span",{staticClass:"line-number"},[t._v("22")]),n("br"),n("span",{staticClass:"line-number"},[t._v("23")]),n("br"),n("span",{staticClass:"line-number"},[t._v("24")]),n("br"),n("span",{staticClass:"line-number"},[t._v("25")]),n("br"),n("span",{staticClass:"line-number"},[t._v("26")]),n("br"),n("span",{staticClass:"line-number"},[t._v("27")]),n("br"),n("span",{staticClass:"line-number"},[t._v("28")]),n("br"),n("span",{staticClass:"line-number"},[t._v("29")]),n("br"),n("span",{staticClass:"line-number"},[t._v("30")]),n("br"),n("span",{staticClass:"line-number"},[t._v("31")]),n("br"),n("span",{staticClass:"line-number"},[t._v("32")]),n("br"),n("span",{staticClass:"line-number"},[t._v("33")]),n("br"),n("span",{staticClass:"line-number"},[t._v("34")]),n("br"),n("span",{staticClass:"line-number"},[t._v("35")]),n("br"),n("span",{staticClass:"line-number"},[t._v("36")]),n("br"),n("span",{staticClass:"line-number"},[t._v("37")]),n("br"),n("span",{staticClass:"line-number"},[t._v("38")]),n("br"),n("span",{staticClass:"line-number"},[t._v("39")]),n("br"),n("span",{staticClass:"line-number"},[t._v("40")]),n("br"),n("span",{staticClass:"line-number"},[t._v("41")]),n("br"),n("span",{staticClass:"line-number"},[t._v("42")]),n("br"),n("span",{staticClass:"line-number"},[t._v("43")]),n("br"),n("span",{staticClass:"line-number"},[t._v("44")]),n("br")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("2、当"),s("code",[this._v("oldStartIdx > oldEndIdx")]),this._v("时，表示 oldCh 已经先遍历结束，即 newCh 还没有遍历完，则 newStartIdx 和 newEndIdx 之间的 vnode 是新增的，则插入新节点")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldStartIdx "),n("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" oldEndIdx"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{attrs:{class:"token comment"}},[t._v("//添加新节点")]),t._v("\n    refElm "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("isUndef")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("newCh"),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("newEndIdx "),n("span",{attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),n("span",{attrs:{class:"token number"}},[t._v("1")]),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("?")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" newCh"),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("newEndIdx "),n("span",{attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),n("span",{attrs:{class:"token number"}},[t._v("1")]),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("elm"),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token function"}},[t._v("addVnodes")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        parentElm"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        refElm"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        newCh"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        newStartIdx"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        newEndIdx"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        insertedVnodeQueue\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("如图：\n"),s("img",{attrs:{src:n(163),alt:"diff4"}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("3、当"),s("code",[this._v("newStartIdx > newEndIdx")]),this._v("时，表示 newCh 已经先遍历结束，说明 oldCh 中剩余的节点在新的子节点里已经不存在了，此时应该删除 oldStartIdx 和 oldEndIdx 之间的 vnode")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("newStartIdx "),n("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" newEndIdx"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{attrs:{class:"token comment"}},[t._v("//删除老节点")]),t._v("\n    "),n("span",{attrs:{class:"token function"}},[t._v("removeVnodes")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("parentElm"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" oldCh"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" oldStartIdx"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" oldEndIdx"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("如图：\n"),s("img",{attrs:{src:n(164),alt:"diff5"}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"自我检测"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#自我检测","aria-hidden":"true"}},[this._v("#")]),this._v(" 自我检测")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("如图：\n"),s("img",{attrs:{src:n(165),alt:"diff6"}}),this._v(" "),s("br"),s("br")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("如图：\n"),s("img",{attrs:{src:n(166),alt:"diff7"}})])}],e=n(0),r=Object(e.a)({},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"content"},[t._m(0),t._v(" "),t._m(1),t._v(" "),n("p",[t._v("UpdateChildren : 更新子节点")]),t._v(" "),t._m(2),t._v(" "),t._m(3),n("p",[t._v("1、oldCh 和 newCh 各有两个头尾的变量 StartIdx 和 EndIdx，它们的 2 个变量相互比较，一共有 4 种比较方式。")]),t._v(" "),n("p",[t._v("2、如果 4 种比较都没匹配，就会用 key 进行比较：拿 newStartVnode 的 key 值在 oldCh 中遍历，如果存在相同 key 的节点并且 与 newStartVnode 是相同节点，则移动 Dom 节点，否则创建新元素。。")]),t._v(" "),t._m(4),t._v(" "),t._m(5),t._v(" "),t._m(6),t._m(7),t._v(" "),n("p",[t._v("索引图：")]),t._v(" "),t._m(8),t._v(" "),n("p",[t._v("1.1、")]),t._v(" "),t._m(9),n("p",[t._v("1.2、oldCh 和 newCh 各自的两个头尾的变量 StartIdx 和 EndIdx，它们每 2 个变量相互比较，一共有以下 4 种比较方式，索引不断向中间靠拢")]),t._v(" "),t._m(10),t._m(11),t._m(12),t._v(" "),t._m(13),t._m(14),t._v(" "),n("br"),t._v(" "),n("p",[t._v("1.3、以上 4 种比较方法没有成功后，开始用 key 进行比较")]),t._v(" "),t._m(15),n("br"),t._v(" "),t._m(16),t._v(" "),t._m(17),t._m(18),t._v(" "),n("br"),t._v(" "),t._m(19),t._v(" "),t._m(20),t._m(21),t._v(" "),n("br"),t._v(" "),t._m(22),t._v(" "),n("p",[t._v("最后，引用网上一个例子，画出了 diff 完整的过程，每一步 dom 的变化都用不同颜色的线标出，大家可以自我检测一下是否掌握了 diff 过程：")]),t._v(" "),n("p",[t._v("1、a,b,c,d,e 假设是 4 个不同的元素，我们没有设置 key 时，b 没有复用，而是直接创建新的，删除旧的。")]),t._v(" "),t._m(23),t._v(" "),n("p",[t._v("2、当我们给 4 个元素加上唯一 key 时，b 得到了的复用。")]),t._v(" "),t._m(24),t._v(" "),n("br"),t._v(" "),n("blockquote",[n("p",[n("font",{attrs:{color:"gray",size:"3"}},[t._v(" 图片来源于："),n("a",{attrs:{href:"https://github.com/aooy/blog/issues/2",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/aooy/blog/issues/2"),n("OutboundLink")],1)])],1)]),t._v(" "),n("br"),t._v(" "),n("div",{staticClass:"tip custom-block"},[n("p",{staticClass:"custom-block-title"},[t._v("注释")]),t._v(" "),n("p",[n("a",{attrs:{href:"https://github.com/510team/vue-resource-analysis/blob/master/src/core/vdom/patch.js",target:"_blank",rel:"noopener noreferrer"}},[t._v("查看 vue 相关源码"),n("OutboundLink")],1)])])])},a,!1,null,null,null);r.options.__file="updateChildren.md";s.default=r.exports}}]);